rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ============================================
    // DEVELOPMENT MODE RULES (Less Secure)
    // Use these rules for development/testing
    // Allows access based on userId path parameter
    // ============================================
    
    // Allow users to read/write their own data based on userId in path
    // This works with your current local authentication system
    match /users/{userId}/{document=**} {
      // Allow read/write if the userId in the path matches
      // Note: This is less secure as it relies on client-provided userId
      // For production, use Firebase Authentication (see PRODUCTION RULES below)
      allow read, write: if userId != null && userId != '';
    }
    
    // Specific collections for better organization
    match /users/{userId}/moods/{moodId} {
      allow read, write: if userId != null && userId != '';
    }
    
    match /users/{userId}/health_vitals/{vitalId} {
      allow read, write: if userId != null && userId != '';
    }
    
    match /users/{userId}/medicines/{medicineId} {
      allow read, write: if userId != null && userId != '';
    }
    
    // ============================================
    // PRODUCTION MODE RULES (More Secure)
    // Uncomment these and comment out the rules above for production
    // Requires Firebase Authentication to be enabled
    // ============================================
    
    /*
    // Users can only read/write their own data when authenticated
    match /users/{userId}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Specific collections with authentication
    match /users/{userId}/moods/{moodId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    match /users/{userId}/health_vitals/{vitalId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    match /users/{userId}/medicines/{medicineId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    */
  }
}

